<template>
  <div class="Container">
    <div id='features'></div>
    <!-- 右上角zoom坐标显示 -->
    <el-tag class="mapZoomLngLat" type="info">
      Zoom:{{ zoom }} &nbsp; LngLat:{{ showCenter }}
    </el-tag>
    <div class="leftBar">
      <div class="leftBarTitle">
        <h2>{{ mapProjectInfo.name }}</h2>
        <h3 style="margin: 1.2rem 0">编辑区</h3>
        <el-divider class="divider"></el-divider>
      </div>

      <div class="flexRowSpaceAround" style="width: 100%">
        <!--        打开shp选择框，添加shplayer数据-->
        <div>
          <el-popover
              placement="right"
              width="250"
              trigger="click">
            <el-table :data="shpTableData">
              <el-table-column property="originName" width="170" show-overflow-tooltip label="名称"></el-table-column>
              <el-table-column width="80" label="操作">
                <template slot-scope="scope">
                  <el-button
                      size="mini"
                      type="primary"
                      @click="handleAddShpLayer(scope.$index, scope.row)"
                  >添加
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                small
                @current-change="handleCurrentChangeShp"
                :current-page="currentPageShp"
                :page-size="pageSizeShp"
                layout="total, prev, pager, next"
                :total="totalDataCountShp"
                class="flexRowCenter"
            >
            </el-pagination>
            <el-button type="primary" slot="reference" @click="addShpData">添加数据</el-button>
          </el-popover>

        </div>
        <el-button type="success" slot="reference" @click="saveMap">保存地图</el-button>
        <el-button type="info" slot="reference" @click="test">test</el-button>
      </div>

      <!--      shp图层-->
      <el-divider class="divider">图层</el-divider>
      <div class="layerTable">
        <el-table :data="layers" ref="shpLayerTable" row-key="id" size="mini" @cell-click="handleLayerClick()"
                  style="width: 100%">
          <el-table-column width="40">
            <template slot-scope="scope">
              <el-switch :width="30" v-model="scope.row.show" @change="handleLayerShowSwitchChange($event,scope.row)">
              </el-switch>
            </template>
          </el-table-column>
          <el-table-column
              label="类型"
              prop="type"
              min-width="60"
              show-overflow-tooltip
          >
          </el-table-column>
          <el-table-column
              label="名称"
              prop="id"
              min-width="100"
              show-overflow-tooltip
          >
          </el-table-column>
          <el-table-column label="操作" min-width="115">
            <template slot-scope="scope">
              <el-button
                  size="mini"
                  type="success"
                  @click="handleLayerEdit(scope.$index, scope.row)"
                  icon="el-icon-edit"
                  circle
                  style="  margin-left: 5px;"
              >
              </el-button>
              <el-button
                  size="mini"
                  type="danger"
                  @click="handleLayerDelete(scope.$index, scope.row)"
                  icon="el-icon-delete"
                  circle
                  style="  margin-left: 5px;"
              >
              </el-button>
              <el-popover
                  placement="right"
                  width="200"
                  trigger="click">
                <el-select v-model="scope.row.type" placeholder="请选择"
                           @change="handleLayerStyleChange(scope.$index, scope.row)">
                  <el-option
                      v-for="item in [{value:'symbol',label:'图标(symbol)'},{value:'circle',label:'圆(circle)'}]"
                      :key="item.value"
                      :label="item.label"
                      :value="item.value">
                  </el-option>
                </el-select>

                <el-button
                    v-if="scope.row.type==='circle'||scope.row.type==='symbol'"
                    size="mini"
                    type="primary"
                    icon="el-icon-setting"
                    circle
                    style="  margin-left: 5px;"
                    slot="reference">
                </el-button>
              </el-popover>

            </template>
          </el-table-column>
        </el-table>
      </div>
    </div>

    <div class="editBoard" >
      <div v-show="nameEdit === false" class="editBoardTitle" @click="nameEdit = true">
        <div> {{ layers[nowLayerIndex]["id"] }}</div>
        <i class="el-icon-edit"></i>
      </div>  
      <div v-show="nameEdit === true" class="editBoardTitle" >
        <el-input v-model="layers[nowLayerIndex]['id']" size="mini" @change="nameEdit=false"></el-input>
        <i class="el-icon-check" @click="nameEdit=false"></i>
      </div>        
      <el-tabs value="first">      
        <!--    圆点图层编辑面板-->
        <el-tab-pane label="样式设置" name="first">
          <el-tabs v-if="editorShow=='circleEditorShow'" type="border-card" tab-position="left">
            <el-tab-pane label="颜色" >
              <el-row style="display:flex">
                <el-color-picker
                    v-model="layers[nowLayerIndex].paint['circle-color']"
                    @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-color',layers[nowLayerIndex].paint['circle-color'])"
                    :predefine="predefineColors">
                </el-color-picker>          
                <el-input v-model="layers[nowLayerIndex].paint['circle-color']"
                          @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-color',layers[nowLayerIndex].paint['circle-color'])"
                          placeholder="something" style="width:50%"></el-input>
              </el-row>
              <br>
              <el-button style="padding-left:10px;padding-right:50%;width:100%;" @click="rateEditShow = true">
                <span>变化率：&nbsp;&nbsp;</span>{{Rate}}
              </el-button>
              <el-dialog
                :visible.sync="rateEditShow"
                width="30%"
                center :close-on-click-modal = false
                :modal= false :show-close= false>
                <span>变化率：</span>&nbsp;&nbsp;
                <el-select v-model="Rate1" placeholder="插值类型" style="width:73%">
                  <el-option
                    v-for="item in [{value: 'linear',label: 'linear'},{value: 'exponential',label: 'exponential'},{value: 'cubic-bezier',label: 'cubic-bezier'}]"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value">
                  </el-option>
                </el-select> 
                <br><br>
                <el-row>{{rateContent[Rate]}}</el-row>               
                <span slot="footer" class="dialog-footer">
                  <!-- <el-button @click="rateEditShow = false">取 消</el-button> -->
                  <el-button type="primary" @click="rateEditShow = false;Rate = Rate1">确 定</el-button>
                </span>            
              </el-dialog> 
              <br><br>             
              <el-table
                ref="tableList"
                :data="zoomColor"
                style="width: 100%"
                class="tableCondition"
                :row-class-name="tableRowClassName"
                @row-click="handleZoomEdit"
                >
                <el-table-column
                  prop="zoom"
                  label="缩放"
                  width="80%">
                </el-table-column>
                <el-table-column
                  label="颜色"
                  width="120%">         
                  <template slot-scope="scope">
                    <div class="el-icon-s-grid" :style="{'color': scope.row.color}"></div>
                    <span style="margin-left: 10px">{{ scope.row.color }}</span>
                  </template>              
                </el-table-column>
              </el-table>
              <el-button
                type = "text"
                @click="zoomColor.unshift({zoom:0,color:'#000000'});zoomEditIndex= 0;zoomEditShow= true"
              >+ 增加zoom级别条件
              </el-button>

              <el-dialog
                title="zoom条件编辑"
                :visible.sync="zoomEditShow"
                width="30%"
                center :close-on-click-modal = false
                :modal= false>
                <el-row>
                  <el-input v-model="zoomColor[zoomEditIndex].zoom"
                            placeholder="something" style="width:80%">
                    <template slot="prepend" body-style="padding:0">zoom:</template>
                  </el-input>              
                </el-row>
                <br>
                <el-row style="display:flex">         
                  <el-input v-model="zoomColor[zoomEditIndex].color"
                            placeholder="something" style="width:80%">
                    <template slot="prepend" >color:&nbsp;</template>
                  </el-input>
                  <el-color-picker
                      v-model="zoomColor[zoomEditIndex].color"
                      :predefine="predefineColors">
                  </el-color-picker>               
                </el-row>
                
                <span slot="footer" class="dialog-footer">
                  <el-button @click="zoomEditDelete">删除</el-button>
                  <el-button type="primary" @click="zoomEditFirm">确 定</el-button>
                </span>            
              </el-dialog>

              <el-button ></el-button>
            </el-tab-pane>
            <el-tab-pane label="半径">
              <h3>半径（px）</h3>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-radius']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-radius',layers[nowLayerIndex].paint['circle-radius'])"
                              :min="0" :max="99999"
                              size="medium"

                              label="描述文字">
              </el-input-number>


            </el-tab-pane>
            <el-tab-pane label="透明度">

              <h3>透明度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['circle-opacity']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-opacity',layers[nowLayerIndex].paint['circle-opacity'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-opacity']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-opacity',layers[nowLayerIndex].paint['circle-opacity'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>

            </el-tab-pane>
            <el-tab-pane label="边线颜色">
              <h3>边线颜色</h3>
              <el-input v-model="layers[nowLayerIndex].paint['circle-stroke-color']"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-stroke-color',layers[nowLayerIndex].paint['circle-stroke-color'])"
                        placeholder="something"></el-input>
              <el-color-picker
                  v-model="layers[nowLayerIndex].paint['circle-stroke-color']"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-stroke-color',layers[nowLayerIndex].paint['circle-stroke-color'])"
                  :predefine="predefineColors">
              </el-color-picker>
            </el-tab-pane>
            <el-tab-pane label="边线宽度">
              <h3>边线宽度</h3>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-stroke-width']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-stroke-width',layers[nowLayerIndex].paint['circle-stroke-width'])"
                              :min="0" :max="99999"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="边线透明度">
              <h3>边线透明度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['circle-stroke-opacity']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-stroke-opacity',layers[nowLayerIndex].paint['circle-stroke-opacity'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-stroke-opacity']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-stroke-opacity',layers[nowLayerIndex].paint['circle-stroke-opacity'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="模糊">
              <h3>模糊度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['circle-blur']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-blur',layers[nowLayerIndex].paint['circle-blur'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-blur']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-blur',layers[nowLayerIndex].paint['circle-blur'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="平移">
              <h3>平移</h3>
              <h4>x方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-translate'][0]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-translate',layers[nowLayerIndex].paint['circle-translate'])">
              </el-input-number>
              <h4>y方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['circle-translate'][1]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-translate',layers[nowLayerIndex].paint['circle-translate'])">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="平移参考">
              <h3>平移参考</h3>
              <el-select v-model="layers[nowLayerIndex].paint['circle-translate-anchor']" placeholder="请选择"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-translate-anchor',layers[nowLayerIndex].paint['circle-translate-anchor'])">
                <el-option
                    v-for="item in ['map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item">
                </el-option>
              </el-select>
            </el-tab-pane>

            <el-tab-pane label="倾斜对齐">
              <h3>倾斜对齐</h3>
              <el-select v-model="layers[nowLayerIndex].paint['circle-pitch-alignment']" placeholder="请选择"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-pitch-alignment',layers[nowLayerIndex].paint['circle-pitch-alignment'])">
                <el-option
                    v-for="item in ['map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item">
                </el-option>
              </el-select>
            </el-tab-pane>
            <el-tab-pane label="倾斜缩放">
              <h3>倾斜缩放</h3>
              <el-select v-model="layers[nowLayerIndex].paint['circle-pitch-scale']" placeholder="请选择"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-pitch-scale',layers[nowLayerIndex].paint['circle-pitch-scale'])">
                <el-option
                    v-for="item in ['map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item">
                </el-option>
              </el-select>
            </el-tab-pane>

          </el-tabs>

        <!--    线图层编辑面板-->
          <el-tabs v-if="editorShow=='lineEditorShow'" type="border-card" tab-position="left">
            <div class="editBoardTitle">
              <h2> {{ layers[nowLayerIndex]["id"] }}</h2>

              <i class="el-icon-close close-button" style="font-size: 22px" @click="handleCloseEditBoard"></i>
              <!--          <el-button icon="el-icon-close" circle></el-button>-->
            </div>

            <el-tab-pane label="颜色">
              <h3>线颜色</h3>
              <el-input v-model="layers[nowLayerIndex].paint['line-color']"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'circle-color',layers[nowLayerIndex].paint['line-color'])"
                        placeholder="something"></el-input>
              <el-color-picker
                  v-model="layers[nowLayerIndex].paint['line-color']"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-color',layers[nowLayerIndex].paint['line-color'])"
                  :predefine="predefineColors">
              </el-color-picker>


            </el-tab-pane>
            <el-tab-pane label="线宽">
              <h3>线宽（px）</h3>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-width']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-width',layers[nowLayerIndex].paint['line-width'])"
                              :min="0" :max="99999"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="透明度">
              <h3>透明度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['line-opacity']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-opacity',layers[nowLayerIndex].paint['line-opacity'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-opacity']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-opacity',layers[nowLayerIndex].paint['line-opacity'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>


            </el-tab-pane>
            <el-tab-pane label="虚线">
              <h3>虚线</h3>
              <div class="flexRowSpaceAround"
                  v-for="(item, index) in layers[nowLayerIndex].paint['line-dasharray']"
                  :key="index"
                  style="height: 40px;">
                <h4 v-if="index %2 ==0">实部:</h4>
                <h4 v-else>虚部:</h4>
                <el-input-number v-model="layers[nowLayerIndex].paint['line-dasharray'][index]"
                                @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-dasharray',layers[nowLayerIndex].paint['line-dasharray'])"
                                :min="0"
                                size="small"
                                label="描述文字">
                </el-input-number>&nbsp;
                <el-button type="danger" icon="el-icon-delete" size="mini" circle @click="layers[nowLayerIndex].paint['line-dasharray'].splice(index,1)"></el-button>
              </div>

              <el-button type="primary" round @click="layers[nowLayerIndex].paint['line-dasharray'].push(0)">添加虚线设置
              </el-button>
            </el-tab-pane>
            <el-tab-pane label="线间隙">
              <h3>线间隙宽度</h3>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-gap-width']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-gap-width',layers[nowLayerIndex].paint['line-gap-width'])"
                              :min="0" :max="99999"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>

            <el-tab-pane label="模糊">
              <h3>模糊度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['line-blur']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-blur',layers[nowLayerIndex].paint['line-blur'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-blur']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-blur',layers[nowLayerIndex].paint['line-blur'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="平移">
              <h3>平移</h3>
              <h4>x方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-translate'][0]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-translate',layers[nowLayerIndex].paint['line-translate'])">
              </el-input-number>
              <h4>y方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-translate'][1]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-translate',layers[nowLayerIndex].paint['line-translate'])">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="平移参考">
              <h3>平移参考</h3>
              <el-select v-model="layers[nowLayerIndex].paint['line-translate-anchor']" placeholder="请选择"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-translate-anchor',layers[nowLayerIndex].paint['line-translate-anchor'])">
                <el-option
                    v-for="item in ['map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item">
                </el-option>
              </el-select>
            </el-tab-pane>
            <el-tab-pane label="偏移">
              <h3>偏移</h3>
              <el-input-number v-model="layers[nowLayerIndex].paint['line-offset']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'line-offset',layers[nowLayerIndex].paint['line-offset'])"
                              :min="0" :max="99999"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="线帽">
              <h3>线帽</h3>
              <el-select v-model="layers[nowLayerIndex].layout['line-cap']" placeholder="请选择"
                        @change="handleLayoutChange(layers[nowLayerIndex]['id'],'line-cap',layers[nowLayerIndex].layout['line-cap'])">
                <el-option
                    v-for="item in [{label:'平直 butt',value:'butt'},{label:'圆形 round',value:'round'},{label:'方形 square',value:'square'}]"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value">
                </el-option>
              </el-select>
            </el-tab-pane>
            <el-tab-pane label="线连接">
              <h3>线连接</h3>
              <el-select v-model="layers[nowLayerIndex].layout['line-join']" placeholder="请选择"
                        @change="handleLayoutChange(layers[nowLayerIndex]['id'],'line-join',layers[nowLayerIndex].layout['line-join'])">
                <el-option
                    v-for="item in [{label:'尖角 miter',value:'miter'},{label:'圆角 round',value:'round'},{label:'斜角 bevel',value:'bevel'}]"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value">
                </el-option>
              </el-select>
            </el-tab-pane>


          </el-tabs>

        <!--    面图层编辑面板-->
          <el-tabs v-if="editorShow=='fillEditorShow'" type="border-card" tab-position="left">
            <div class="editBoardTitle">
              <h2> {{ layers[nowLayerIndex]["id"] }}</h2>

              <i class="el-icon-close close-button" style="font-size: 22px" @click="handleCloseEditBoard"></i>
              <!--          <el-button icon="el-icon-close" circle></el-button>-->
            </div>

            <el-tab-pane label="颜色">
              <h3>填充颜色</h3>
              <el-input v-model="layers[nowLayerIndex].paint['fill-color']"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-color',layers[nowLayerIndex].paint['fill-color'])"
                        placeholder="something"></el-input>
              <el-color-picker
                  v-model="layers[nowLayerIndex].paint['fill-color']"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-color',layers[nowLayerIndex].paint['fill-color'])"
                  :predefine="predefineColors">
              </el-color-picker>
            </el-tab-pane>

            <el-tab-pane label="透明度">
              <h3>透明度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['fill-opacity']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-opacity',layers[nowLayerIndex].paint['fill-opacity'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['fill-opacity']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-opacity',layers[nowLayerIndex].paint['fill-opacity'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>

            <el-tab-pane label="边线颜色">
              <h3>边线颜色</h3>
              <span>（该属性需要抗锯齿属性为true）</span>
              <el-input v-model="layers[nowLayerIndex].paint['fill-outline-color']"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-outline-color',layers[nowLayerIndex].paint['fill-outline-color'])"
                        placeholder="something"></el-input>
              <el-color-picker
                  v-model="layers[nowLayerIndex].paint['fill-outline-color']"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-outline-color',layers[nowLayerIndex].paint['fill-outline-color'])"
                  :predefine="predefineColors">
              </el-color-picker>
            </el-tab-pane>

            <el-tab-pane label="平移">
              <h3>平移</h3>
              <h4>x方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['fill-translate'][0]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-translate',layers[nowLayerIndex].paint['fill-translate'])">
              </el-input-number>
              <h4>y方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['fill-translate'][1]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-translate',layers[nowLayerIndex].paint['fill-translate'])">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="平移参考">
              <h3>平移参考</h3>
              <el-select v-model="layers[nowLayerIndex].paint['fill-translate-anchor']" placeholder="请选择"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-translate-anchor',layers[nowLayerIndex].paint['fill-translate-anchor'])">
                <el-option
                    v-for="item in ['map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item">
                </el-option>
              </el-select>
            </el-tab-pane>

            <el-tab-pane label="抗锯齿">
              <h3>抗锯齿</h3>
              <el-switch v-model="layers[nowLayerIndex].paint['fill-antialias']"
                        @change="handlePaintChange(layers[nowLayerIndex]['id'],'fill-antialias',layers[nowLayerIndex].paint['fill-antialias'])">
              </el-switch>
            </el-tab-pane>

          </el-tabs>

        <!--    图标图层编辑面板-->
          <el-tabs v-if="editorShow=='symbolEditorShow'" type="border-card" tab-position="left">
            <div class="editBoardTitle">
              <h2> {{ layers[nowLayerIndex]["id"] }}</h2>

              <i class="el-icon-close close-button" style="font-size: 22px" @click="handleCloseEditBoard"></i>
              <!--          <el-button icon="el-icon-close" circle></el-button>-->
            </div>

            <el-tab-pane label="图标">
              <h3>图标选择</h3>
              <el-table
                  :data="symbolTableData"
                  style="width: 200px">
                <el-table-column
                    prop="originNmae"
                    label="预览"
                    width="50">
                </el-table-column>
                <el-table-column
                    prop="originName"
                    label="名称"
                    width="100">
                </el-table-column>

                <el-table-column label="操作" width="50">
                  <template slot-scope="scope">
                    <el-button @click="handleClick(scope.row)" type="text" size="small">使用</el-button>
                  </template>
                </el-table-column>

              </el-table>
              <el-pagination
                  small
                  @current-change="handleCurrentChangeSymbol"
                  :current-page="currentPageSymbol"
                  :page-size="pageSizeSymbol"
                  layout="total, prev, pager, next"
                  :total="totalDataCountSymbol"
                  class="flexRowCenter"
              >
              </el-pagination>
            </el-tab-pane>

            <el-tab-pane label="图标大小">
              <h3>图标大小</h3>
              <el-input-number v-model="layers[nowLayerIndex].layout['icon-size']"
                              @change="handleLayoutChange(layers[nowLayerIndex]['id'],'icon-size',layers[nowLayerIndex].layout['icon-size'])"
                              :min="0" :max="99999"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>

            <el-tab-pane label="透明度">
              <h3>透明度</h3>
              <el-slider
                  v-model="layers[nowLayerIndex].paint['icon-opacity']"
                  :min=0
                  :max=1
                  :marks="{0:'0',0.5:'0.5',1:'1'}"
                  @change="handlePaintChange(layers[nowLayerIndex]['id'],'icon-opacity',layers[nowLayerIndex].paint['icon-opacity'])"
                  :step=0.1>
              </el-slider>
              <br>
              <el-input-number v-model="layers[nowLayerIndex].paint['icon-opacity']"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'icon-opacity',layers[nowLayerIndex].paint['icon-opacity'])"
                              :min="0"
                              :max="1"
                              :step="0.1"
                              size="medium"
                              label="描述文字">
              </el-input-number>
            </el-tab-pane>


            <el-tab-pane label="平移">
              <h3>平移</h3>
              <h4>x方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['icon-translate'][0]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'icon-translate',layers[nowLayerIndex].paint['icon-translate'])">
              </el-input-number>
              <h4>y方向（px）：</h4>
              <el-input-number v-model="layers[nowLayerIndex].paint['icon-translate'][1]"
                              :step="1"
                              @change="handlePaintChange(layers[nowLayerIndex]['id'],'icon-translate',layers[nowLayerIndex].paint['icon-translate'])">
              </el-input-number>
            </el-tab-pane>
            <el-tab-pane label="平移参考">
              <h3>平移参考</h3>
              <el-select v-model="layers[nowLayerIndex].paint['icon-translate-anchor']" placeholder="请选择">
                <el-option
                    v-for="item in ['map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item"
                    @change="handlePaintChange(layers[nowLayerIndex]['id'],'icon-translate-anchor',layers[nowLayerIndex].paint['icon-translate-anchor'])">
                </el-option>
              </el-select>
            </el-tab-pane>

            <el-tab-pane label="倾斜对齐">
              <h3>倾斜对齐</h3>
              <el-select v-model="layers[nowLayerIndex].paint['icon-pitch-alignment']" placeholder="请选择">
                <el-option
                    v-for="item in ['auto','map','viewport']"
                    :key="item"
                    :label="item"
                    :value="item"
                    @change="handlePaintChange(layers[nowLayerIndex]['id'],'icon-pitch-alignment',layers[nowLayerIndex].paint['icon-pitch-alignment'])">
                </el-option>
              </el-select>
            </el-tab-pane>


          </el-tabs>
        </el-tab-pane>
        <el-tab-pane label="数据设置" name="second">
          <span>数据源配置</span>
          <el-form :label-position="right">
            <el-form-item label="数据源">
              <span>{{ layers[nowLayerIndex]["source"] }}</span>
            </el-form-item>  
            <el-form-item label="数据源图层">
              <span>{{ layers[nowLayerIndex]["source-layer"] }}</span>
            </el-form-item>  
            <el-form-item label="图层名称">
              <span>{{ layers[nowLayerIndex]["name"] }}</span>
            </el-form-item>                                                 
            <el-form-item label="图层类型">
              <el-select v-model="layers[this.nowLayerIndex].type" placeholder="请选择图层类型">
                <el-option
                  v-for="item in [{value: 'circle',label: '圆(circle)'},{value: 'symbol',label: '符号(symbol)'},{value: 'line',label: '线(line)'},{value: 'fill',label: '填充(fill)'},{value: 'fill-extrusion',label: '三维填充(fill-extrusion)'}]"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value">
                </el-option>
              </el-select>
            </el-form-item>            
          </el-form>
          <el-divider></el-divider>
          <el-row type="flex" justify="space-between">
            <span>过滤条件配置</span>
            <el-select v-model="filterCondition" placeholder="请选择">
              <el-option
                v-for="item in [{value: 'and',label: '满足所有条件'},{value: 'or',label: '满足任意条件'},{value: '!',label: '不满足任意条件'},]"
                :key="item.value"
                :label="item.label"
                :value="item.value">
              </el-option>
            </el-select>
          </el-row>
          <el-row v-for="(item,index) in filterCondition" :key="index">
            <el-button type="text" icon="el-icon-remove-outline" @click="filterCondition.splice(index,1)"></el-button>
            <el-select v-model="filterCondition[index]['options']" placeholder="请选择">
              <el-option
                v-for="item in options"
                :key="item.value"
                :label="item.label"
                :value="item.value">
              </el-option>
            </el-select> 
            <el-select v-model="filterCondition[index]['type']" placeholder="==">
              <el-option
                v-for="item in options"
                :key="item.value"
                :label="item.label"
                :value="item.value">
              </el-option>
            </el-select>                        
            <el-input placeholder="" v-model="filterCondition[index]['type']"></el-input>
            <el-button type="text" icon="el-icon-s-unfold"></el-button>

          </el-row>
          <el-col v-if="filterCondition.length = 0" class="displayBox">未设置过滤条件</el-col>
          <el-button type="text" icon="el-icon-circle-plus-outline"
          @click="filterCondition.push({options:'',type:'==',value:''})">添加过滤条件</el-button>



          <el-divider></el-divider>
          <span>显示级别配置</span>
          <el-form :label-position="right">
            <el-form-item label="最小级别">
              <el-slider
                :max="layers[nowLayerIndex]['maxzoom']"
                :min="zoomRange[0]"
                v-model="layers[nowLayerIndex]['minzoom']"
                show-input show-stops>
              </el-slider>              
            </el-form-item>          
            <el-form-item label="最大级别">
              <el-slider
                :max="zoomRange[1]"
                :min="layers[nowLayerIndex]['minzoom']"
                v-model="layers[nowLayerIndex]['maxzoom']"
                show-input show-stops>
              </el-slider>              
            </el-form-item>                
          </el-form>  
        </el-tab-pane>      

      </el-tabs>
      <i class="el-icon-close close-button" @click="handleCloseEditBoard"></i>
    </div>

    <div class="rightMap">
      <div id="map" class="mapStyle"></div>
    </div>
  </div>
</template>

<script>
import mapboxgl from "mapbox-gl";
import requestApi from "../api/requestApi";
import layerStyleProperties from "../assets/js/layerStyleProperties";
import Sortable from "sortablejs";

var map = null;

export default {
  data() {
    return {

      //添加shp数据时列表
      shpTableData: [],
      currentPageShp: 1,
      pageSizeShp: 5,
      searchInputShp: "",
      totalDataCountShp: 0,

      //左侧shp图层树
      layersNameObject: {}, //检测重复  后端字段为nameObject
      layersName: [], //加载的图层id集合，用于展示图层按index的排列

      //mapbox地图
      mapProjectInfo: {},
      mapProjectId: "", //地图项目id
      zoom: 6,
      center: "119,32",
      showCenter: "119,32",
      sources: {},
      layers: [],


      //插值类型
      value: '',
      Rate: 'linear',
      Rate1: 'linear',
      rateEditShow: false,
      rateContent: {linear:'线性：在刚好小于和刚好大于输入的停止点对之间进行线性插值。',exponential:'指数：在小于和大于输入的停靠点之间以指数方式插值。','cubic-bezier':'贝塞尔曲线：使用由给定控制点定义的三次贝塞尔曲线进行插值。'},



      //zoom变化
      colorInit: '',
      zoomColor: [{zoom:0,color:'#000000'}],
      zoomEditShow: false,
      zoomEditIndex: 0,
      zoomCondition: [],
      zoomRange: ["0","24"],    //设置初始值，当编辑图层时进行重新赋值

      nowLayerIndex: 0,
      editorShow: '',
      nameEdit: false,

      //过滤条件
      filterWay: "满足所有条件",
      filterCondition: [],

      predefineColors: [
        '#ff4500',
        '#ff8c00',
        '#ffd700',
        '#90ee90',
        '#00ced1',
        '#1e90ff',
        '#c71585'],

      //图标数据
      symbolTableData:[],
      currentPageSymbol: 1,
      pageSizeSymbol: 5,
      searchInputSymbol: "",
      totalDataCountSymbol: 0,



    };
  },
  mounted() {
    this.mapProjectId = this.$route.params.mapProjectId
    this.getMapProjectInfo()

    //layer拖动排序
    this.initSort();
  },

  methods: {
    test() {
      console.log("cccc")
      map.setLayoutProperty("map_points", "circle-sort-key", 99999);
      let pt = map.getLayoutProperty('map_points', 'circle-sort-key');
      console.log("pt sort key", pt)
    },
    getMapProjectInfo() {
      requestApi.getMapProjectById(this.mapProjectId)
          .then((res) => {
            console.log('请求结果：',res)
            this.mapProjectInfo = res.data.data
            console.log(this.mapProjectInfo);
            this.center = this.mapProjectInfo.center.split(',')
            this.zoom = this.mapProjectInfo.zoom
            this.sources = this.mapProjectInfo.sources
            this.layers = this.mapProjectInfo.layers.layers
            this.layersNameObject = this.mapProjectInfo.nameObject
            this.createEmptyMap()
            this.initMapWithData()
            for (const i in this.layers) {
              this.layersName.push(this.layers[i].id)
            }
          })
          .catch((error) => {
            console.log(error);
          });
    },

    //创建空地图
    createEmptyMap() {
      mapboxgl.accessToken =
          "pk.eyJ1Ijoid3lqcSIsImEiOiJjbDBnZDdwajUxMXRzM2htdWxubDh1MzJrIn0.2e2_rdU2nOUvtwltBIZtZg";

      map = new mapboxgl.Map({
        container: "map",
        // glyphs: "mapbox://fonts/mapbox/{fontstack}/{range}.pbf",

        // style: "mapbox://styles/mapbox/streets-v11", // style URL
        // center: this.center,
        // zoom: this.zoom,
      });

      // 添加比例尺
      var scale = new mapboxgl.ScaleControl({
        maxWidth: 120,
        unit: "imperial",
      });
      map.addControl(scale);
      scale.setUnit("metric");

      // 添加控件缩放按钮和一个指南针.
      var nav = new mapboxgl.NavigationControl();
      map.addControl(nav, "top-right");
      // 全局缩放
      map.addControl(new mapboxgl.FullscreenControl());

      //添加定位控件
      map.addControl(
          new mapboxgl.GeolocateControl({
            positionOptions: {
              enableHighAccuracy: true,
            },
            trackUserLocation: true,
          })
      );

      //zoom
      map.on("zoom", () => {
        this.zoom = map.getZoom().toFixed(2);
      });

      //center
      map.on("mousemove", (e) => {
        // this.center =
        //     String(e.lngLat.lng.toFixed(8)) +
        //     "," +
        //     String(e.lngLat.lat.toFixed(8));
        this.center = String(e.lngLat.lng) + "," + String(e.lngLat.lat)
        this.showCenter = String(e.lngLat.lng.toFixed(5)) + "," + String(e.lngLat.lat.toFixed(5))
      });

      //选中某元素
      map.on('mouseenter',this.layersName,  function () {
        map.getCanvas().style.cursor = 'pointer';
        // console.log("eeeeeeeeee gid:", e);
      });

      // Change it back to a pointer when it leaves.
      map.on('mouseleave', this.layersName, function () {
        map.getCanvas().style.cursor = '';
      });

      //点击元素事件
      map.on('click', this.layersName, (e) => {
        //点击范围
        const bbox = [
        [e.point.x - 5, e.point.y - 5],
        [e.point.x + 5, e.point.y + 5]
        ];
        // Find features intersecting the bounding box.
        const selectedFeatures = map.queryRenderedFeatures(bbox, {
        layers: this.layersName
        });
        var container = window.document.createElement('div');
        container.className = "container";
        var nameList = [];

        for (const i in selectedFeatures) {
          let feature = selectedFeatures[i];
          if(nameList.indexOf(feature.layer.id) === -1){
            nameList.push(feature.layer.id);
          }else{
            continue  //避免相同图层元素重复展现
          }
          //为popup添加DOM元素
          let item = window.document.createElement('div');
          var item_name = window.document.createElement('div');
          let colorBox = window.document.createElement('div');

          container.appendChild(item).className = "item";
          item.appendChild(colorBox).className = "colorBox";
          item.appendChild(item_name).className = "item_name";
          item_name.innerHTML = feature.layer.id;

          var index = this.layersName.indexOf(feature.layer.id);

          //根据index获取相关图层信息
          const color_name = feature.layer.type+'-'+'color';
          colorBox.style.setProperty('background-color',this.layers[index].paint[color_name]);

          this.addItemEvent(item,feature,index);

        }

        console.log('selectedFeatures',selectedFeatures)    

        new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setDOMContent(container)
        .addTo(map);
      });      


      // map.on("load", () => {
      //
      //   //添加mapbox示例数据
      //   map.addLayer({
      //     id: "terrain-data",
      //     type: "line",
      //     source: {
      //       type: "vector",
      //       url: "mapbox://mapbox.mapbox-terrain-v2",
      //     },
      //     "source-layer": "contour",
      //     layout: {
      //       "line-join": "round",
      //       "line-cap": "round",
      //     },
      //     paint: {
      //       "line-color": "#ff69b4",
      //       "line-width": 1,
      //     },
      //   });
      // });
    },

    //数据回来后初始化地图
    initMapWithData() {
      console.log("initMapWithData");

      map.setZoom(this.zoom)
      map.setCenter(this.center)

      for (let i in this.sources) {
        let newSource = {
          sourceName: i,
          sourceType: this.sources[i].type,
          sourceTiles: this.sources[i].tiles,
        }
        this.addSourceToMap(newSource)
      }

      for (let i = this.layers.length - 1; i >= 0; i--) {
        this.addLayerToMap(this.layers[i])
      }
    },

    saveMap() {
      this.$confirm('是否保存地图?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {

        for (let i in this.layers) {
          this.layers[i].layout.visibility = this.layers[i].show ? "visible" : "none"
        }

        this.mapProjectInfo.zoom = this.zoom
        this.mapProjectInfo.center = this.center.toString()
        this.mapProjectInfo.sources = this.sources
        this.mapProjectInfo.layers = {layers: this.layers}
        this.mapProjectInfo.nameObject = this.layersNameObject

        requestApi.updateMapProject(JSON.stringify(this.mapProjectInfo))
            .then(() => {
              this.$message.success('保存成功!');
            })
            .catch((error) => {
              console.log(error);
            });
      }).catch(() => {
        this.$message.info("取消保存");
      });
    },

    //打开shp选择框
    addShpData() {
      requestApi.getShpList({
        asc: false,
        page: this.currentPageShp,
        pageSize: this.pageSizeShp,
        searchText: this.searchInputShp,
        sortField: "uploadDate",
      })
          .then((res) => {
            console.log(res.data);
            this.shpTableData = res.data.data.content;
            this.totalDataCountShp = res.data.data.totalElements;
          })
          .catch((error) => {
            console.log(error);
          });
    },

    handleCurrentChangeShp(val) {
      this.currentPageShp = val;
      this.addShpData();
    },

    initSort() {
      const tbody = this.$refs.shpLayerTable.$el.querySelectorAll('.el-table__body-wrapper > table > tbody')[0]
      const _this = this
      Sortable.create(tbody, {
        draggable: ".el-table__row",
        animation: 150,
        onEnd({newIndex, oldIndex}) {
          _this.handleCloseEditBoard()
          const currRow = _this.layers.splice(oldIndex, 1)[0]
          _this.layers.splice(newIndex, 0, currRow)
          _this.handleShowSortChange(newIndex)
        }
      })
    },


    handleShowSortChange(newIndex) {
      let aimLayer = this.layers[newIndex];
      this.handleRemoveLayer(aimLayer.id)
      if (newIndex === 0) {
        map.addLayer(aimLayer)
      } else {
        map.addLayer(aimLayer, this.layers[newIndex - 1].id)
      }
      //更改顺序后更新
      for (const i in this.layers) {
        this.layersName[i] = this.layers[i].id
      }      

    },

    //向shp树添加shp,即source,同时添加shplayer
    handleAddShpLayer(index, row) {
      console.log(row)
      let newSource = {
        sourceName: row.tableName,
        sourceType: "vector",
        sourceTiles: [this.reqUrl +"/mvt/" + row.tableName + "/{z}/{x}/{y}.pbf"],
      }
      if (!Object.prototype.hasOwnProperty.call(this.sources, newSource.sourceName)) {
        this.sources[newSource.sourceName] = {
          type: newSource.sourceType,
          tiles: newSource.sourceTiles,
        }
        this.addSourceToMap(newSource)
      }
      let geoType = row.geoType

      if (row.geoType.indexOf("LINE") !== -1) {
        geoType = "line"
      } else if (row.geoType.indexOf("POLYGON") !== -1) {
        geoType = "fill"
      } else {
        geoType = "circle"
      }

      let newLayer = {
        index: index,
        show: true,
        originName: row.originName,
        id: row.originName,
        type: geoType,
        filter: ["all"],
        layout: layerStyleProperties[geoType].layout,
        maxzoom: 22,
        metadata: "",
        minzoom: 0,
        paint: layerStyleProperties[geoType].paint,
        source: newSource.sourceName,
        "source-layer": "default"
      }
      if (geoType !== "symbol") {
        newLayer.paint[geoType + "-color"] = "#" + Math.random().toString(16).substr(2, 6)
      }

      if (!Object.prototype.hasOwnProperty.call(this.layersNameObject, newLayer.originName)) {
        this.layersNameObject[newLayer.originName] = 1
      } else {
        this.layersNameObject[newLayer.originName] += 1
        newLayer.id = row.originName + this.layersNameObject[newLayer.originName]
      }

      this.layers.unshift(newLayer)
      this.layersName.unshift(newLayer.id)
      this.addLayerToMap(newLayer)
    },

    //向地图添加数据源source
    addSourceToMap(newSource) {
      console.log("add new source：" + newSource.sourceName)

      map.addSource(newSource.sourceName, {
        type: newSource.sourceType,
        tiles: newSource.sourceTiles,
      })
    },

    //向地图添加layer
    addLayerToMap(newLayer) {
      console.log("add new layer：" + newLayer.id)
      map.addLayer(newLayer)
    },

    loadAndAddImg(imgUrl, imgName) {
      map.loadImage(imgUrl, (error, image) => {
        if (error) throw error;
        map.addImage(imgName, image);
      })
    },

    handleLayerEdit(index, row) {
      console.log(index, row)
      this.nowLayerIndex = index;
      this.zoomRange = [this.layers[this.nowLayerIndex].minzoom,this.layers[this.nowLayerIndex].maxzoom]
      if (row.type === "line") {
        this.editorShow = 'lineEditorShow'
      } else if (row.type === "fill") {
        this.editorShow = 'fillEditorShow'
      } else if (row.type === "circle") {
        this.editorShow = 'circleEditorShow'
      } else {
        this.editorShow = "symbolEditorShow"
        this.getSymbolList()
      }
    },

    handleCloseEditBoard() {
      this.editorShow = ''
    },

    handleLayerDelete(index, row) {
      index, row
      this.editorShow=""
      let aimSource = row.source
      let layerOriginName = row.originName
      let layerid = row.id
      this.layers.splice(index, 1)
      this.layersName.splice(index, 1)
      this.layersNameObject[layerOriginName] -= 1
      this.handleRemoveLayer(layerid)
      if (this.layersNameObject[layerOriginName] === 0) {
        delete this.layersNameObject[layerOriginName]
        this.handleRemoveSource(aimSource)
        delete this.sources[aimSource]
      }
      
    },

    handleLayerStyleChange(index, row) {
      index, row
      console.log("row: ",row)
      // map.removeLayer(row.id);
      //
      // let newLayer=row
      //
      //
      // if (index === 0) {
      //   map.addLayer(aimLayer)
      // } else {
      //   map.addLayer(aimLayer, this.layers[newIndex - 1].id)
      // }
    },

    getSymbolList(){
      requestApi.getSymbolList({
        asc: false,
        page: this.currentPageSymbol,
        pageSize: this.pageSizeSymbol,
        searchText: this.searchInputSymbol,
        sortField: "createTime",
      })
          .then((res) => {
            console.log(res.data);
            this.symbolTableData = res.data.data.content;
            this.totalDataCountSymbol = res.data.data.totalElements;
          })
          .catch((error) => {
            console.log(error);
          });
    },

    handleCurrentChangeSymbol(val){
      this.currentPageSymbol=val
      this.getSymbolList()
    },

    handleLayerClick() {
      console.log(this.layers);
      map.flyTo({
        center:[101.34948058466824,32.22862318628209]
      });
      // var render = 
      //   [
      //   "interpolate",
      //   ["exponential", 0.5],
      //   ["zoom"],
      //   2,
      //   "#e2714b",
      //   5,
      //   "#eee695"
      //   ];        
      // this.handlePaintChange('ChinaProvince','fill-color',render)
      // this.layers[3].paint['fill-color'] = 0
      // if (row.type === "circle") {
      //   this.pointEditorShow = !this.pointEditorShow;
      // }
    },

    handleLayerShowSwitchChange(val, row) {
      if (val) {
        this.handleLayoutChange(row.id, "visibility", "visible")
      } else {
        this.handleLayoutChange(row.id, "visibility", "none")
      }
    },

    handleRemoveSource(sourceName) {
      map.removeSource(sourceName);
    },

    handleRemoveLayer(layerName) {
      map.removeLayer(layerName);
    },

    handleLayoutChange(layerName, key, value) {
      console.log("layout:", layerName, key, value)
      map.setLayoutProperty(layerName, key, value);
    },

    handlePaintChange(layerName, key, value) {
      console.log("paint:", layerName, key, value)
      map.setPaintProperty(layerName, key, value);
    },

    addItemEvent(item,feature,index){
      //因为item是html元素，在其事件中this指向该元素无法获取vue的实例属性和方法
      let _this = this;      
      item.onclick = function test(){
        _this.nowLayerIndex = index;
        if (feature.layer.type === "line") {
          _this.editorShow = 'lineEditorShow';
        } else if (feature.layer.type === "fill") {
          _this.editorShow = 'fillEditorShow';
        } else if (feature.layer.type === "circle") {
          _this.editorShow = 'circleEditorShow';
        } else {
          _this.editorShow = "symbolEditorShow";
          _this.getSymbolList()
        }  
      };      
    },
    //对zoom变化各行进行处理
    tableRowClassName({row,rowIndex}){
      row.index = rowIndex;
    },
    handleZoomEdit(row){
      //zoomEditShow设置成数组，dialog不会正常关闭
      // this.zoomEditShow = ['true',0];
      this.zoomEditShow = true;
      this.zoomEditIndex = row.index;
      console.log('row:',row)
    },
    zoomEditDelete(){
      this.zoomEditShow = false;
      this.zoomColor.splice(this.zoomEditIndex,1);
    },
    zoomEditFirm(){
      this.zoomEditShow = false;
      let Object = this.zoomColor[this.zoomEditIndex];
      let num = Object.zoom;
      this.zoomColor.splice(this.zoomEditIndex,1)
      // console.log('Object',Object)
      // console.log('num:',num);

      for(let i in this.zoomColor){
        //js的var是弱类型，默认是string类型，10>2不成立
        if((num - this.zoomColor[i].zoom) < 0 ){
          this.zoomColor.splice(i,0,Object);
          // console.log('num:',num);
          // console.log('this.zoomColor[i].zoom:',this.zoomColor[i].zoom);          
          break;
        }        
        if(i == this.zoomColor.length-1){
          console.log('i:',i);
          this.zoomColor.push(Object);
          break;
        }
      }
      //重置列表排序
      // this.$refs.tableList.sort('zoom', 'ascending')
      // console.log('zoom:',this.zoomColor)

      //设置多级显示
      // this.zoomCondition = ["interpolate",[this.Rate,]]
      // this.zoomRender(this.layers[this.nowLayerIndex].id,'fill-color',)
    },
    // zoomRender(){

    // }




  
  },
};
</script>

<style>

#temp-features {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  width: 300px;
  overflow: auto;
  background: rgba(255, 255, 255, 0.8);
}

.Container {
  width: 100%;
  height: 100%;
  display: flex;
}

.leftBar {
  min-width: 330px;
  display: flex;
  /* border: 2px solid black; */
  flex-direction: column;
  align-items: center;
}

.leftBarTitle {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.layerTable {
  width: 100%;
}

/* 编辑框样式 */
.editBoard {
  display: flex;
  height: 100%;
  width: 350px;
  position: absolute;
  margin-left: 330px;
  z-index: 99;
}

.el-icon-close.close-button{
  font-size: 22px;
  position:absolute;
  right:10px;
  height:40px;
  line-height: 40px;
}
/* 编辑框文本名框 */
.editBoardTitle {
  position: absolute;
  font-weight: bold;
  width: 140px;
  left: 20px;
  top: 0;
  height: 40px;
  line-height: 40px;
  z-index: 1;
  /* background-color: #4264fb; */
  display: flex;
  align-items: center;
}
.editBoardTitle div{
  display:inline-block;
  width:120px;
  height: 40px;
  white-space:nowrap;
  overflow: hidden;  
  text-overflow: ellipsis;

}
.editBoardTitle .el-icon-edit{
  display: none;
}
.editBoardTitle:hover .el-icon-edit{
  display: block;
  cursor: pointer;
}
.editBoardTitle:hover div{
  cursor:pointer;
  color: #75b9ff;
}

.close-button:hover {
  cursor: pointer;
  color: Red;
}
/* 编辑框导航条tabs */
.editBoard .el-tabs__header.is-top{
  background-color: rgb(255, 255, 255);
  width: 300px;  
  margin: 0;
  border-left: 1px solid #e4e7ed;
  border-right: 1px solid #e4e7ed;
  padding-right: 50px;
  justify-content: right;
  display: flex;
}
.el-tabs__item{
  padding: 0 10px;
}

.editBoard .el-tabs__header.is-top .el-tabs__nav-wrap.is-top{
  text-align: left;

}
.editBoard .el-tabs--border-card > .el-tabs__header {
  background-color: rgb(255, 255, 255);
  width: 100px;
  height: calc(100vh - 42px);
}

.editBoard .el-tabs--border-card {
  box-shadow: none;
}

.editBoard .el-tabs--left.el-tabs--border-card .el-tabs__item.is-left {
  text-align: left;
  padding: 0px 10px;
  /*margin: 10px 0px;*/
}

.editBoard .el-tabs--border-card > .el-tabs__content {
  margin: 5px 10px 0px 0px;
  width: 200px;
}

/* 属性框样式 */
.tableCondition .el-table__body-wrapper.is-scrolling-none:hover{
  cursor:pointer;
  background-color: #4264fb;
}

.rightMap {
  width: 100%;
}

.mapZoomLngLat {
  position: absolute;
  top: 10px;
  right: 60px;
  z-index: 99;
  background-color: #ffffff !important;
  font-size: 13px;
}

.displayBox{
  width: 100%;
  border: 1px dashed #d3d3d3;
  border-radius: 5px;
  text-align: center;
  /* 将该元素禁用 */
  pointer-events: none;  
}

.mapStyle {
  width: 100%;
  height: 100%;
}

.divider {
  margin: 12px 0;
}

/* popup样式 */
.container{
  width: 150px;
  /* height: 30px; */
}
.item{
  color: black;
  border-radius: 5px;
}
.item:hover{
  color: #4264fb;
  background-color: #e0e7eb;
}
.colorBox{
  width: 18px;
  height: 18px;
  /* background-color: red; */
  float: left;
  display: inline-block;
  border-radius: 5px;
  margin: 1px;
}
.item_name{
  margin-left: 30px;
}
</style>